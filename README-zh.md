# Flow - å·¥ä½œæµç¼–æ’åº“

ğŸŒ **è¯­è¨€åˆ‡æ¢**: [English Documentation](README.md)

Flow æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Go è¯­è¨€å·¥ä½œæµæ„å»ºå’Œæ‰§è¡Œåº“ï¼Œæä¾›ä¸¤ç§æ‰§è¡Œæ¨¡å¼ï¼šçº¿æ€§æ‰§è¡Œé“¾ï¼ˆChainï¼‰å’Œå›¾å½¢åŒ–æ‰§è¡Œå™¨ï¼ˆGraphï¼‰ã€‚

## åŠŸèƒ½ç‰¹æ€§

### Chain æ¨¡å¼

- **çº¿æ€§æ‰§è¡Œ**: æŒ‰é¡ºåºæ‰§è¡Œä»»åŠ¡ï¼Œæ­¥éª¤ä¾æ¬¡è¿è¡Œ
- **è‡ªåŠ¨å‚æ•°ä¼ é€’**: ä¸Šä¸€æ­¥è¾“å‡ºè‡ªåŠ¨ä½œä¸ºä¸‹ä¸€æ­¥è¾“å…¥
- **é”™è¯¯å¤„ç†**: å…¨é¢çš„é”™è¯¯ä¼ æ’­å’Œå¤„ç†æœºåˆ¶
- **ç®€å•æ˜“ç”¨**: é€‚åˆç®€å•çš„é¡ºåºå¤„ç†åœºæ™¯

### Graph æ¨¡å¼

- **å›¾å½¢å·¥ä½œæµ**: ä½¿ç”¨èŠ‚ç‚¹ï¼ˆNodeï¼‰å’Œè¾¹ï¼ˆEdgeï¼‰æ„å»ºå¤æ‚å·¥ä½œæµ
- **å¤šç§è¾¹ç±»å‹**: æ”¯æŒæ™®é€šè¾¹ã€å¾ªç¯è¾¹å’Œåˆ†æ”¯è¾¹
- **æ¡ä»¶æ‰§è¡Œ**: ä¸ºè¾¹æ·»åŠ æ¡ä»¶ä»¥æ§åˆ¶å·¥ä½œæµè·¯å¾„
- **å¹¶è¡Œæ‰§è¡Œ**: å¹¶å‘æ‰§è¡Œç‹¬ç«‹èŠ‚ç‚¹ä»¥æé«˜æ€§èƒ½
- **è‡ªåŠ¨å‚æ•°å¤„ç†**: ä»»åŠ¡é—´æ™ºèƒ½å‚æ•°ä¼ é€’å’Œç±»å‹è½¬æ¢
- **é”™è¯¯å¤„ç†**: å…¨é¢çš„é”™è¯¯ä¼ æ’­å’Œå¤„ç†æœºåˆ¶
- **æ£€æŸ¥ç‚¹æ”¯æŒ**: ä¿å­˜å’Œæ¢å¤å·¥ä½œæµçŠ¶æ€ä»¥å®ç°å®¹é”™
- **æš‚åœ/æ¢å¤**: æš‚åœå·¥ä½œæµæ‰§è¡Œå¹¶åœ¨ç¨åæ¢å¤
- **å¯è§†åŒ–æ”¯æŒ**: ç”Ÿæˆ Mermaid å’Œ Graphviz å›¾è¡¨ç”¨äºå·¥ä½œæµå¯è§†åŒ–

## æ ¸å¿ƒæ¦‚å¿µ

### èŠ‚ç‚¹ (Node)

**èŠ‚ç‚¹** ä»£è¡¨å·¥ä½œæµä¸­çš„å•ä¸ªä»»åŠ¡æˆ–æ“ä½œã€‚æ¯ä¸ªèŠ‚ç‚¹åŒ…å«ï¼š

- **name**: èŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†ç¬¦
- **fn**: è¦æ‰§è¡Œçš„å‡½æ•°
- **status**: å½“å‰æ‰§è¡ŒçŠ¶æ€ï¼ˆpendingã€runningã€completedã€failedï¼‰
- **inputs/outputs**: ä¸å…¶ä»–èŠ‚ç‚¹çš„æ•°æ®æµè½¬è¿æ¥
- **result**: æ‰§è¡Œåçš„è¿”å›å€¼

```go
// æ·»åŠ ä¸€ä¸ªå¸¦å‡½æ•°çš„èŠ‚ç‚¹
g.AddNode("calculate", func(x int) int {
    return x * 2
})
```

### è¾¹ (Edge)

**è¾¹** å®šä¹‰èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å’Œæ•°æ®æµã€‚è¾¹æ§åˆ¶ï¼š

- **from/to**: æºèŠ‚ç‚¹å’Œç›®æ ‡èŠ‚ç‚¹åç§°
- **edgeType**: æ™®é€šã€å¾ªç¯æˆ–åˆ†æ”¯æ‰§è¡Œæµç¨‹
- **condition**: å¯é€‰çš„æ¡ä»¶å‡½æ•°ï¼Œç”¨äºæ§åˆ¶æ‰§è¡Œè·¯å¾„
- **weight**: æ‰§è¡Œä¼˜å…ˆçº§

```go
// åŸºæœ¬è¾¹ - æ•°æ®ä» start æµå‘ process
g.AddEdge("start", "process")

// æ¡ä»¶è¾¹ - ä»…åœ¨æ¡ä»¶ä¸ºçœŸæ—¶æ‰§è¡Œ
g.AddEdge("check", "action", flow.WithCondition(func(result []any) bool {
    return result[0].(int) > 10
}))

// åˆ†æ”¯è¾¹ - ç”¨äºæ¡ä»¶åˆ†æ”¯
g.AddEdge("decision", "branchA", flow.WithEdgeType(flow.EdgeTypeBranch))
```

### ååŒå·¥ä½œæ–¹å¼

```
[èŠ‚ç‚¹ A] â”€â”€è¾¹â”€â”€> [èŠ‚ç‚¹ B] â”€â”€è¾¹â”€â”€> [èŠ‚ç‚¹ C]
   â”‚                                    â†‘
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€è¾¹â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. **èŠ‚ç‚¹** æ‰§è¡Œå®é™…çš„å·¥ä½œï¼ˆå‡½æ•°ï¼‰
2. **è¾¹** å®šä¹‰æ‰§è¡Œé¡ºåºå’Œæ•°æ®ä¼ é€’
3. å½“èŠ‚ç‚¹ A å®Œæˆåï¼Œå…¶è¾“å‡ºé€šè¿‡è¾¹ä¼ é€’ç»™èŠ‚ç‚¹ B
4. è¾¹çš„æ¡ä»¶å†³å®šèŠ‚ç‚¹ B æ˜¯å¦åº”è¯¥æ‰§è¡Œ

## åŸºå‡†æµ‹è¯•ç»“æœ

åœ¨ Apple M1 Pro (darwin/arm64) ä¸Šçš„åŸºå‡†æµ‹è¯•ç»“æœï¼š

| åŸºå‡†æµ‹è¯• | è¿­ä»£æ¬¡æ•° | æ—¶é—´ (ns/op) | å†…å­˜ (B/op) | åˆ†é…æ¬¡æ•° (allocs/op) |
|-------------|------------|----------------|----------------|-------------------------|
| BenchmarkC32-8 | 69,494 | 16,679 | 3,987 | 37 |
| BenchmarkS32-8 | 418,197 | 2,687 | 2,976 | 34 |
| BenchmarkC6-8 | 193,282 | 5,968 | 1,179 | 16 |
| BenchmarkC8x8-8 | 15,262 | 78,383 | 9,027 | 125 |

**åŸºå‡†æµ‹è¯•è¯´æ˜ï¼š**

- **C32**: 32 ä¸ªç‹¬ç«‹èŠ‚ç‚¹ï¼ˆå®Œå…¨å¹¶è¡Œæ‰§è¡Œï¼‰
- **S32**: 32 ä¸ªèŠ‚ç‚¹é¡ºåºé“¾
- **C6**: 6 ä¸ªèŠ‚ç‚¹çš„è±å½¢ä¾èµ–ç»“æ„
- **C8x8**: 8 å±‚ x 8 èŠ‚ç‚¹æ·±åº¦ç½‘ç»œï¼ˆæ¯å±‚å®Œå…¨è¿æ¥åˆ°ä¸‹ä¸€å±‚ï¼‰

## å®‰è£…

```bash
go get github.com/zkep/flow
```

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€ Chain ç¤ºä¾‹

```go
package main

import (
    "fmt"
    "github.com/zkep/flow"
)

func main() {
    chain := flow.NewChain()

    chain.Add("step1", func() int {
        return 10
    })

    chain.Add("step2", func(x int) int {
        return x * 2
    })

    chain.Add("step3", func(y int) int {
        return y + 5
    })

    err := chain.Run()
    if err != nil {
        fmt.Printf("é”™è¯¯: %v\n", err)
        return
    }

    result, err := chain.Value("step3")
    if err != nil {
        fmt.Printf("é”™è¯¯: %v\n", err)
        return
    }

    fmt.Printf("æœ€ç»ˆç»“æœ: %v\n", result) // è¾“å‡º: 25
}
```

### åŸºç¡€ Graph ç¤ºä¾‹

```go
package main

import (
    "fmt"
    "github.com/zkep/flow"
)

func main() {
    g := flow.NewGraph()

    g.AddNode("start", func() int {
        return 10
    })

    g.AddNode("process1", func(x int) int {
        return x * 2
    })

    g.AddNode("process2", func(x int) int {
        return x + 5
    })

    g.AddNode("end", func(x int) {
        fmt.Printf("æœ€ç»ˆç»“æœ: %d\n", x)
    })

    g.AddEdge("start", "process1")
    g.AddEdge("process1", "process2")
    g.AddEdge("process2", "end")

    err := g.Run()
    if err != nil {
        fmt.Printf("é”™è¯¯: %v\n", err)
    }
}
```

## æ–‡æ¡£

å®Œæ•´æ–‡æ¡£è¯·æŸ¥çœ‹ [docs/doc-zh.md](docs/doc-zh.md)ã€‚

## ç¤ºä¾‹

æŸ¥çœ‹ [_examples](_examples) ç›®å½•è·å–æ›´å¤šç¤ºä¾‹ï¼š

- [basic-chain](_examples/basic-chain/main.go) - åŸºç¡€ Chain ä½¿ç”¨
- [basic-graph](_examples/basic-graph/main.go) - åŸºç¡€ Graph ä½¿ç”¨
- [advanced-chain](_examples/advanced-chain/main.go) - é«˜çº§ Chain ç‰¹æ€§
- [advanced-graph](_examples/advanced-graph/main.go) - é«˜çº§ Graph ç‰¹æ€§
- [approval-flow](_examples/approval-flow/main.go) - å®é™…å®¡æ‰¹æµç¨‹ç¤ºä¾‹

## è®¸å¯è¯

MIT License
